{% set author = "lloyd" %}
{% set name = "yajl" %}
{% set version = "2.1.0" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://github.com/{{ author }}/{{ name }}/archive/refs/tags/{{ version }}.tar.gz
  sha256: 3fb73364a5a30efe615046d07e6db9d09fd2b41c763c5f7d3bfb121cd5c5ac5a

build:
  number: 1
  run_exports:
    - {{ pin_subpackage(name, max_pin="x") }}

requirements:
  build:
    - {{ compiler("c") }}
    - {{ stdlib("c") }}
    - cmake 3.*
    - make  # [unix]
    - jom  # [win]

test:
  requires:
    - pkg-config  # [unix]

  commands:
    - echo "{}" | json_reformat  # [unix]
    - echo "{}" | json_verify  # [unix]

    - test -f ${PREFIX}/include/{{ name }}/{{ name }}_common.h  # [unix]
    - test -f ${PREFIX}/lib/lib{{ name }}_s.a  # [unix]
    - test -f ${PREFIX}/lib/lib{{ name }}.dylib  # [osx]
    - test -f ${PREFIX}/lib/lib{{ name }}.so  # [linux]
    - pkg-config --cflags --libs {{ name }}  # [unix]

    - if not exist %PREFIX%\\Library\\include\\{{ name }}\\{{ name }}_common.h exit 1  # [win]
    - if not exist %PREFIX%\\Library\\lib\\{{ name }}_s.lib exit 1  # [win]
    - if not exist %PREFIX%\\Library\\lib\\{{ name }}.dll exit 1  # [win]

    - conda inspect linkages -p $PREFIX {{ name }}  # [unix]
    - conda inspect objects -p $PREFIX {{ name }}  # [osx]

about:
  home: https://lloyd.github.io/yajl/
  dev_url: https://github.com/lloyd/yajl
  
  license: ISC
  license_file: COPYING
  summary: Yet Another JSON Library
  description: |
    YAJL is a small event-driven (SAX-style) JSON parser written in ANSI C, and
    a small validating JSON generator. YAJL is released under the ISC license.

extra:
  recipe-maintainers:
    - rmax
    - eunos-1128
